use strict;
use warnings;

use FindBin;
use lib "$FindBin::Bin/Kernel/cpan-lib";
use lib "$FindBin::Bin/";

use Kernel::System::ObjectManager;
use Text::CSV;

# Initialize ObjectManager
local $Kernel::OM = Kernel::System::ObjectManager->new();

# Get required objects
my $CSVObject     = Text::CSV->new({ binary => 1, auto_diag => 1 });
my $MainObject    = $Kernel::OM->Get('Kernel::System::Main');
my $UserObject    = $Kernel::OM->Get('Kernel::System::User');
my $GroupObject   = $Kernel::OM->Get('Kernel::System::Group');
my $LogObject     = $Kernel::OM->Get('Kernel::System::Log');

# File
my $CSVFile = 'agents_export.csv';
open my $fh, "<:encoding(utf8)", $CSVFile or die "Cannot open $CSVFile: $!";

# Skip header
$CSVObject->getline($fh);

# Process lines
while (my $row = $CSVObject->getline($fh)) {
    my ($UserLogin, $UserFirstname, $UserLastname, $UserEmail) = @$row;

    # Create user with fixed password
    my $UserID = $UserObject->UserAdd(
        UserFirstname => $UserFirstname,
        UserLastname  => $UserLastname,
        UserLogin     => $UserLogin,
        UserEmail     => $UserEmail,
        UserPassword  => 'DefaultPass123',  # Fixed password
        ValidID       => 1,
        ChangeUserID  => 1,
    );

    if ($UserID) {
        print "✅ Created: $UserLogin (UserID: $UserID)\n";


    } else {
        print "❌ Failed to create: $UserLogin\n";
    }
}

close $fh;
# run inside /opt/otrs as >>  as perl -I /opt/otrs -I /opt/otrs/Kernel/cpan-lib import_agents.pl
                                                                                                                      
